/*!db-wipe 3.0.0 发布日期：2018-11-20*/
function Wipe(t){this.conID=t.id,this.cas=document.getElementById(this.conID),this.context=cas.getContext("2d"),this._w=t.width,this._h=t.height,this.coverType=t.coverType,this.color=t.color||"#666",this.imgUrl=t.imgUrl,this.cas.style.background="url("+t.backImgUrl+") center 0 no-repeat",this.radius=t.radius,this.pox=0,this.poY=0,this.insMouseDown=!1,this.att=0,this.device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera|mini/i.test(navigator.userAgent.toLowerCase()),console.log(this.device),this.drawRect(),this.Box(),this.callback=t.callback}function drawImg(){that.context.drawImage(imgs,0,0,imgs.width,imgs.height,0,0,that._w,that._h),that.context.globalCompositeOperation="destination-out"}Wipe.prototype.drawT=function(t,e,o,i){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.stroke();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.lineWidth=2*this.radius,this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){var t=this.context.getImageData(0,0,this._w,this._h);console.log(t);for(var e=0;e<t.data.length;e+=4){0===t.data[e+3]&&this.att++}return console.log("透明点的个数:"+this.att),this.percent=this.att/(this._w*this._h)*100,console.log("占总面积"+Math.ceil(this.percent)+"%"),(this.att/(this._w*this._h)*100).toFixed(2)},Wipe.prototype.drawRect=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("image"===this.coverType){var t=new Image;t.src=this.imgUrl,t.onload=drawImg}},Wipe.prototype.Box=function(){var s=this;console.log(this),s.clickEvtName=s.device?"touchstart":"mousedown",s.moveEviName=s.device?"touchmove":"mousemove",s.endEvtName=s.device?"touchend":"mouseup";var n=this.cas.offsetLeft;console.log(n);for(var c=this.cas.offsetTop,t=this.cas;t=t.offsetParent;)n+=t.offsetLeft,c+=t.offsetTop;this.cas.addEventListener(s.clickEvtName,function(t){var e=t||window.event;s.insMouseDown=!0;var o=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;s.pox=s.device?e.touches[0].clientX-n+o:e.clientX-n+o,s.poY=s.device?e.touches[0].clientY-c+i:e.clientY-c+i,s.drawT(s.pox,s.poY)},!1),this.cas.addEventListener(s.moveEviName,function(t){var e=document.documentElement.scrollLeft||document.body.scrollLeft,o=document.documentElement.scrollTop||document.body.scrollTop;if(!0===s.insMouseDown){var i=t||window.event;i.preventDefault(),s.moveX=s.device?i.touches[0].clientX-n+e:i.clientX-n+e,s.moveY=s.device?i.touches[0].clientY-c+o:i.clientY-c+o,s.drawT(s.pox,s.poY,s.moveX,s.moveY),s.pox=s.moveX,s.poY=s.moveY}},!1),this.cas.addEventListener(s.endEvtName,function(t){s.insMouseDown=!1;var e=s.getTransparencyPercent(s.context);s.callback.call(null,e),e>s.transpercent&&s.clearRect()},!1)};