/*!db-wipe 1.0.0 发布日期:2018-11-13*/
var cas=document.getElementById("cas"),context=cas.getContext("2d"),_w=cas.width,_h=cas.height,pox=0,poY=0,radius=30,insMouseDown=!1,att=0,device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera|mini/i.test(navigator.userAgent.toLowerCase());console.log(device);var clickEvtName=device?"touchstart":"mousedown",moveEviName=device?"touchmove":"mousemove",endEvtName=device?"touchend":"mouseup";function drawRect(e){e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.globalCompositeOperation="destination-out"}function drawPoint(e,t,n){e.save(),e.beginPath(),e.arc(t,n,30,0,2*Math.PI),e.fillStyle="red",e.fill(),e.stroke()}function drawLine(e,t,n,o,i){e.save(),e.lineCap="round",e.beginPath(),e.moveTo(t,n),e.lineTo(o,i),e.lineWidth=2*radius,e.stroke(),e.restore()}function drawT(e,t,n,o,i){if(3==arguments.length)e.save(),e.beginPath(),e.arc(t,n,radius,0,2*Math.PI),e.fillStyle="red",e.fill(),e.stroke();else{if(5!=arguments.length)return!1;e.save(),e.lineCap="round",e.beginPath(),e.moveTo(t,n),e.lineTo(o,i),e.lineWidth=2*radius,e.stroke(),e.restore()}}function clearRect(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){for(var t=e.getImageData(0,0,_w,_h),n=0;n<t.data.length;n+=4){0==t.data[n+3]&&att++}console.log("透明点的个数:"+att);var o=att/(_w*_h)*100;return console.log("占总面积"+Math.ceil(o)+"%"),Math.round(o)}cas.addEventListener(clickEvtName,function(e){var t=e||window.event;insMouseDown=!0,pox=device?t.touches[0].clientX:t.clientX,poY=device?t.touches[0].clientY:t.clientY,drawT(context,pox,poY)},!1),cas.addEventListener(moveEviName,function(e){if(1==insMouseDown){var t=e||window.event;t.preventDefault();var n=device?t.touches[0].clientX:t.clientX,o=device?t.touches[0].clientY:t.clientY;drawT(context,pox,poY,n,o),pox=n,poY=o}},!1),cas.addEventListener(endEvtName,function(e){insMouseDown=!1,50<getTransparencyPercent(context)&&(alert("超过了50%的面积"),clearRect(context))},!1),window.onload=function(){drawRect(context),drawPoint(context)};